customRules:

  custom-rules-file.yaml: |-

    - macro: apps_secure_k8s_file_read
      condition: (k8s.ns.name in (dev,prd) and (
        (k8s.pod.name startswith db- and proc.exepath = /usr/local/bin/redis-server and fd.name startswith /proc/self/)
        or (k8s.pod.name startswith app- and proc.name = gunicorn and fd.name in (/etc/host.conf, /etc/hosts, /etc/nsswitch.conf, /etc/resolv.conf
        ,/app/templates/index.html
        ,/app/static/stylesheets/style.css
        ))
        or (k8s.pod.name startswith app- and proc.name = gunicorn and fd.name pmatch (/usr/local/lib/python3.9))
        or (k8s.pod.name startswith db- and proc.exepath = /usr/local/bin/redis-server and fd.name startswith /proc/self/)
        or (k8s.pod.name startswith db- and proc.exepath = /usr/local/bin/redis-server and fd.name startswith /data/)
        or (k8s.pod.name startswith dashboard- and proc.exepath = /usr/sbin/nginx and fd.name in (/etc/nginx/conf.d/htpasswd))
        or (k8s.pod.name startswith dashboard- and proc.exepath = /usr/sbin/nginx and fd.name pmatch (/var/tmp/nginx/proxy))
        or (k8s.pod.name startswith dashboard- and proc.exepath = /usr/bin/node and fd.name in (
        /dev/ptmx
        ,/webshell/static/css/lib/bootstrap/bootstrap.min.css
        ,/webshell/static/css/lib/font-awesome/font-awesome.min.css
        ,/webshell/static/css/lib/jqueryui/jquery-ui.min.css
        ,/webshell/static/css/lib/lobipanel/lobipanel.min.css
        ,/webshell/static/css/main.css
        ,/webshell/static/css/separate/pages/widgets.min.css
        ,/webshell/static/css/separate/vendor/lobipanel.min.css
        ,/webshell/static/fonts/glyphicons-halflings-regular.woff2
        ,/webshell/static/fonts/Proxima_Nova_Bold.woff2
        ,/webshell/static/fonts/Proxima_Nova_Light.woff2
        ,/webshell/static/fonts/Proxima_Nova_Regular_Italic.woff2
        ,/webshell/static/fonts/Proxima_Nova_Regular.woff2
        ,/webshell/static/fonts/Proxima_Nova_Semibold.woff2
        ,/webshell/static/fonts/startui.woff
        ,/webshell/static/img/avatar-2-64.png
        ,/webshell/static/img/flags/4x3/us.svg
        ,/webshell/static/img/logo-2-mob.png
        ,/webshell/static/img/logo-2.png
        ,/webshell/static/img/photo-64-1.jpg
        ,/webshell/static/img/photo-64-2.jpg
        ,/webshell/static/img/photo-64-3.jpg
        ,/webshell/static/img/photo-64-4.jpg
        ,/webshell/static/img/statistic-box-green.png
        ,/webshell/static/img/statistic-box-grid.png
        ,/webshell/static/img/statistic-box-purple.png
        ,/webshell/static/img/statistic-box-red.png
        ,/webshell/static/img/statistic-box-yellow.png
        ,/webshell/static/index.html
        ,/webshell/static/js/app.js
        ,/webshell/static/js/lib/bootstrap/bootstrap.min.js
        ,/webshell/static/js/lib/jquery/jquery-3.2.1.min.js
        ,/webshell/static/js/lib/jqueryui/jquery-ui.min.js
        ,/webshell/static/js/lib/lobipanel/lobipanel.min.js
        ,/webshell/static/js/lib/match-height/jquery.matchHeight.min.js
        ,/webshell/static/js/lib/popper/popper.min.js
        ,/webshell/static/js/lib/tether/tether.min.js
        ,/webshell/static/js/plugins.js
        ,/webshell/static/assets/css/demo_1/style.css
        ,/webshell/static/assets/css/shared/style.css
        ,/webshell/static/assets/images/logo_mini.svg
        ,/webshell/static/assets/images/logo.svg
        ,/webshell/static/assets/images/profile/female/image_2.png
        ,/webshell/static/assets/images/profile/female/image_6.png
        ,/webshell/static/assets/images/profile/male/image_10.png
        ,/webshell/static/assets/images/profile/male/image_1.png
        ,/webshell/static/assets/images/profile/male/image_3.png
        ,/webshell/static/assets/images/profile/male/image_4.png
        ,/webshell/static/assets/images/profile/male/image_5.png
        ,/webshell/static/assets/images/profile/male/image_6.png
        ,/webshell/static/assets/images/social-icons/instagram.svg
        ,/webshell/static/assets/js/charts/chartjs.addon.js
        ,/webshell/static/assets/js/dashboard.js
        ,/webshell/static/assets/js/template.js
        ,/webshell/static/assets/vendors/apexcharts/apexcharts.min.js
        ,/webshell/static/assets/vendors/chartjs/Chart.min.js
        ,/webshell/static/assets/vendors/iconfonts/mdi/css/materialdesignicons.css
        ,/webshell/static/assets/vendors/iconfonts/mdi/fonts/materialdesignicons-webfont.woff2
        ,/webshell/static/assets/vendors/js/core.js
        ))
        ))

    #
    #
    #

    - macro: user_apps_file_read
      condition: (
        apps_secure_k8s_file_read
        )

    - macro: never_true
      condition: (evt.num=0)

    - macro: open_write
      condition: (evt.type in (open,openat,openat2) and evt.is_open_write=true and fd.typechar='f' and fd.num>=0)

    - macro: open_read
      condition: (evt.type in (open,openat,openat2) and evt.is_open_read=true and fd.typechar='f' and fd.num>=0)

    - macro: create_symlink
      condition: (evt.type in (symlink, symlinkat) and evt.dir=<)

    - macro: create_hardlink
      condition: (evt.type in (link, linkat) and evt.dir=<)

    - macro: libraries
      condition: (
        (fd.name = /etc/ld.so.cache)
        or (fd.name startswith /usr/lib/)
        or (fd.name startswith /lib/x86_64-linux-gnu/)
        )

    - macro: file_read
      condition: (
        (container.id = host and (
           proc.exepath = /usr/bin/kubelet
           or (proc.exepath = /usr/bin/cmp and proc.pname startswith apt.systemd.dai and fd.name in (/proc/self/maps, /var/backups/apt.extended_states.0, /var/lib/apt/extended_states))
           or (proc.exepath = /usr/bin/dash and proc.name = dpkg-db-backup and fd.name in (/usr/libexec/dpkg/dpkg-db-backup, /usr/share/dpkg/sh/dpkg-error.sh))
           or (proc.exepath = /usr/bin/date and proc.pname = sa2 and fd.name in (/etc/localtime))
           or (proc.exepath = /usr/bin/find and proc.pname = sa2 and fd.name in (/proc/filesystems, /usr/bin))
           or (proc.exepath = /usr/bin/grep and proc.pname = sa2 and fd.name in (/proc/self/maps))
           or (proc.exepath = /usr/bin/xargs and proc.aname[2] = sa2 and fd.name in (/dev/null))
           or (proc.exepath = /usr/bin/sar.sysstat and proc.pname = sa2 and fd.name in (/etc/localtime, /var/log/sysstat/sa19))
           or (proc.exepath = /usr/bin/tar and proc.pname = dpkg-db-backup and fd.name in (/etc/passwd, /etc/group, /etc/nsswitch.conf, /proc/filesystems))
           or (proc.exepath = /usr/bin/tar and proc.pname = dpkg-db-backup and fd.name pmatch (/var/backups/))
           or (proc.exepath = /usr/bin/tar and proc.pname = dpkg-db-backup and fd.name pmatch (/var/lib/dpkg/alternatives))
           or (proc.exepath = /usr/bin/cmp and proc.pname = dpkg-db-backup and fd.name in (/proc/self/maps))
           or (proc.exepath = /usr/bin/cmp and proc.pname = dpkg-db-backup and fd.name pmatch (/var/backups))
           or (proc.exepath = /usr/bin/cmp and proc.pname = dpkg-db-backup and fd.name pmatch (/var/lib/dpkg))
           or (proc.exepath = /usr/bin/date and proc.pname startswith apt.systemd.dai and fd.name in (/etc/localtime))
           or (proc.exepath = /usr/bin/apt-config and fd.name = /dev/null)
           or (proc.exepath = /usr/bin/apt-config and fd.name pmatch (/etc/apt/apt.conf.d/))
           or (proc.exepath = /usr/bin/apt-config and fd.name pmatch (/usr/share/dpkg/))
           or (proc.exepath = /usr/bin/apt-get and fd.name in (/dev/null, /etc/localtime, /etc/machine-id))
           or (proc.exepath = /usr/bin/apt-get and fd.name pmatch (/etc/apt))
           or (proc.exepath = /usr/bin/apt-get and fd.name pmatch (/usr/share/dpkg/))
           or (proc.exepath = /usr/bin/apt-get and fd.name pmatch (/var/cache/apt/))
           or (proc.exepath = /usr/bin/apt-get and fd.name pmatch (/var/lib/apt/))
           or (proc.exepath = /usr/bin/apt-get and fd.name pmatch (/var/lib/dpkg/))
           or (proc.exepath = /usr/bin/apt-helper and fd.name pmatch (/etc/apt))
           or (proc.exepath = /usr/bin/apt-helper and fd.name pmatch (/usr/share/dpkg/))
           or (proc.exepath = /usr/bin/dpkg and fd.name pmatch (/etc/dpkg/))
           or (proc.exepath = /usr/bin/dpkg and fd.name in (/proc/filesystems))
           or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name in (/dev/null, /proc/sys/net/core/somaxconn, /usr/local/bin/containerd-shim-runc-v2))
           or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name pmatch (/run/containerd/))
           or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name pmatch (/proc/self/))
           or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name glob "/proc/*/cgroup")
           or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name pmatch (/sys/fs/cgroup/))
           or (proc.exepath = /usr/local/bin/containerd and fd.name startswith /var/lib/containerd/)
           or (proc.exepath = /usr/local/bin/containerd and fd.name pmatch (/proc/self/))
           or (proc.exepath = /usr/local/bin/containerd and fd.name pmatch (/run/containerd/))
           or (proc.exepath = /usr/local/bin/containerd and fd.name pmatch (/var/run/netns/))
           or (proc.exepath = /usr/local/bin/containerd and fd.name in (/dev/null))
           or (proc.exepath = usr/bin/systemctl and fd.name startswith /proc/filesystems)
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name in (//bin, /dev/null, //usr/bin/bash,
              //usr/bin, //usr, //sys, //run, /var/lib/systemd/timers/stamp-apt-daily.timer,
              /usr/libexec/dpkg/dpkg-db-backup, /usr/sbin/logrotate, /var/lib/systemd/timers/stamp-logrotate.timer))
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /proc/)
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name pmatch (/sys/dev/block))
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name pmatch (/sys/devices/))
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name pmatch (/sys/dev))
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /run/udev/data)
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name pmatch (/run/systemd))
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /sys/fs/cgroup/system.slice/)
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /sys/fs/cgroup/kubepods.slice/)
           or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /tmp/namespace-dev-)
           or (proc.exepath = /usr/lib/systemd/systemd-journald and fd.name startswith /proc/)
           or (proc.exepath = /usr/lib/systemd/systemd-journald and fd.name startswith /run/systemd/journal/streams/)
           or (proc.exepath = /usr/sbin/logrotate and fd.name in (/, /etc/passwd, /etc/group, /etc/localtime, /etc/nsswitch.conf, /proc/filesystems))
           or (proc.exepath = /usr/sbin/logrotate and fd.name startswith /etc/logrotate)
           or (proc.exepath = /usr/sbin/logrotate and fd.name pmatch (/var/lib/logrotate/))
           or (proc.exepath = /usr/lib/sysstat/sadc and fd.name in (/etc/localtime, /etc/sensors3.conf))
           or (proc.exepath = /usr/lib/sysstat/sadc and fd.name startswith /proc/)
           or (proc.exepath = /usr/lib/sysstat/sadc and fd.name startswith /sys/class/net/)
           or (proc.exepath = /usr/lib/sysstat/sadc and fd.name startswith /var/log/sysstat/sa)
           or (proc.exepath = /usr/bin/kmod and fd.name startswith /lib/modprobe.d/)
           or (proc.exepath = /usr/bin/kmod and fd.name startswith /lib/modules/)
           or (proc.exepath = /usr/bin/kmod and fd.name = /proc/cmdline)
           or (proc.exepath = /usr/sbin/cron and fd.name pmatch (/etc/))
           or (proc.exepath = /usr/sbin/cron and fd.name in (/proc/1/limits, /proc/sys/kernel/ngroups_max, /var/run/utmp))
           or (proc.exepath = /usr/sbin/xtables-nft-multi and fd.name = /proc/net/ip_tables_names)
           or (proc.exepath = /usr/bin/dash and proc.name = sa1 and fd.name = /etc/sysstat/sysstat)
           or (proc.exepath = /usr/bin/bash and proc.name = sa2 and fd.name = /etc/sysstat/sysstat)
           or (proc.exepath = /usr/bin/dash and proc.name startswith ifupdown-hotplu and fd.name = /lib/udev/ifupdown-hotplug)
           or (proc.exepath = /usr/bin/dbus-daemon and fd.name glob "/proc/*/cmdline" )
           or (proc.exepath = /usr/bin/dbus-daemon and fd.name = /run/systemd/users/0 )
           or (proc.exepath = /usr/bin/udevadm and fd.name in (/dev/null, //lib))
           or (proc.exepath = /usr/bin/udevadm and fd.name pmatch (/etc))
           or (proc.exepath = /usr/bin/udevadm and fd.name pmatch (/run))
           or (proc.exepath = /usr/bin/udevadm and fd.name pmatch (/sys))
           or (proc.exepath = /usr/bin/udevadm and fd.name pmatch (/usr))
           or (proc.exepath = /usr/bin/umount and fd.name in (/proc/filesystems, /proc/self/mountinfo))
           or (proc.exepath = /usr/bin/umount and fd.name pmatch (/var/lib/kubelet/pods))
           or (proc.exepath = /opt/cni/bin/bridge and fd.name glob "/proc/*/task/*/ns/net" )
           or (proc.exepath = /opt/cni/bin/bridge and fd.name pmatch (/var/run/netns))
           or (proc.exepath = /opt/cni/bin/flannel and fd.name pmatch (/var/lib/cni/flannel))
           or (proc.exepath = /opt/cni/bin/host-local and fd.name pmatch (/var/lib/cni/networks))
           or (proc.exepath = /opt/cni/bin/loopback and fd.name glob "/proc/*/task/*/ns/net" )
           or (proc.exepath = /opt/cni/bin/loopback and fd.name pmatch (/var/run/netns))
           or (proc.cmdline = "6 init" and proc.name = 6 and proc.pname = runc and fd.name in (/proc/self/exe, /proc/self/oom_score_adj))
        ))
        or (proc.exepath = /usr/sbin/runc and fd.name pmatch (/run/containerd/))
        or (proc.exepath = /usr/sbin/runc and fd.name pmatch (/sys/fs/cgroup/))
        or (proc.exepath = /usr/sbin/runc and fd.name pmatch (/proc/))
        or (proc.exepath = /usr/sbin/runc and fd.name in (/dev/null, /etc/localtime, /usr/sbin/runc))
        or (proc.exepath = /usr/sbin/runc and fd.name in (/, /etc/group, /etc/passwd) and proc.name startswith runc:)
        or (k8s.ns.name = falco and (
           (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falco and fd.name in (/etc/hosts, /etc/nsswitch.conf, /etc/resolv.conf, /etc/host.conf, /sys/devices/system/cpu/online))
           or (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falcoctl and fd.name startswith /root/.sigstore/)
           or (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falcoctl and fd.name startswith /rulesfiles/)
           or (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falcoctl and fd.name startswith /tmp/falcoctl-)
           or (k8s.pod.name startswith falco-falcosidekick- and proc.exepath = /app/falcosidekick and fd.name in (/etc/hosts, /etc/resolv.conf, /etc/nsswitch.conf))
           or (k8s.pod.name startswith falco-falcosidekick-ui- and proc.exepath = /app/falcosidekick-ui and fd.name startswith /app/frontend/dist)
           or (k8s.pod.name startswith falco-falcosidekick-ui- and proc.exepath = /app/falcosidekick-ui and fd.name in (/etc/hosts, /etc/resolv.conf, /proc/sys/net/core/somaxconn))
           or (k8s.pod.name startswith falco-falcosidekick-ui-redis- and proc.exepath = /opt/redis-stack/nodejs/bin/node and fd.name in (/etc/hosts))
           or (k8s.pod.name startswith falco-falcosidekick-ui-redis- and proc.exepath = /opt/redis-stack/bin/redis-server and fd.name = /proc/self/smaps)
           or (k8s.pod.name startswith falco-falcosidekick-ui-redis- and proc.exepath = /opt/redis-stack/bin/redis-server and fd.name glob "/proc/*/stat")
        ))
        or (k8s.ns.name = kube-flannel and (
           (k8s.pod.name startswith kube-flannel and proc.exepath = /opt/bin/flanneld and fd.name in (/dev/null, /var/run/secrets/kubernetes.io/serviceaccount/token))
           or (k8s.pod.name startswith kube-flannel and proc.exepath = /sbin/xtables-nft-multi and fd.name = /proc/net/ip_tables_names)
        ))
        or (k8s.ns.name = kube-system and (
           (k8s.pod.name startswith etcd- and proc.exepath = /usr/local/bin/etcd and fd.name = /proc/self/fd)
           or (k8s.pod.name startswith etcd- and proc.exepath = /usr/local/bin/etcd and fd.name startswith /var/lib/etcd/member/)
           or (k8s.pod.name startswith etcd- and proc.exepath = /usr/local/bin/etcd and fd.name startswith /etc/kubernetes/pki/etcd/)
           or (k8s.pod.name startswith kube-apiserver- and proc.exepath = /usr/local/bin/kube-apiserver and fd.name startswith /etc/kubernetes/pki/apiserver-)
           or (k8s.pod.name startswith kube-proxy- and proc.exepath = /usr/local/bin/kube-proxy and fd.name in (/dev/null, /etc/nsswitch.conf, /etc/protocols, /var/run/secrets/kubernetes.io/serviceaccount/token))
           or (k8s.pod.name startswith kube-proxy- and proc.exepath = /usr/sbin/xtables-nft-multi and fd.name in (/proc/net/ip_tables_names, /etc/nsswitch.conf, /etc/protocols))
           or (k8s.pod.name startswith coredns- and proc.exepath = /coredns and fd.name in (/etc/coredns/Corefile, /var/run/secrets/kubernetes.io/serviceaccount/token))
        ))
        )

    - macro: file_write
      condition: (
        (container.id = host and (
          proc.exepath = /usr/bin/kubelet
          or (proc.exepath = /usr/bin/apt-config and fd.name = /dev/null)
          or (proc.exepath = /usr/bin/apt-get and fd.name in (/dev/null, /var/lib/dpkg/lock, /var/lib/dpkg/lock-frontend))
          or (proc.exepath = /usr/lib/apt/apt-helper and fd.name = /dev/null)
          or (proc.exepath = /usr/bin/gpgconf and fd.name = /dev/null)
          or (proc.exepath = /usr/bin/udevadm and fd.name = /proc/self/oom_score_adj)
          or (proc.exepath = /usr/bin/dash and fd.name in (/dev/null, /run/motd.dynamic.new, /var/lib/apt/daily_lock))
          or (proc.exepath = /usr/bin/bash and fd.name in (/dev/tty, /root/.bash_history))
          or (proc.exepath = /usr/bin/bash and proc.name = sa2 and fd.name in (/dev/null, /var/log/sysstat/sar19))
          or (proc.exepath = /usr/lib/systemd/systemd and fd.name = /proc/self/oom_score_adj)
          or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /run/systemd/transient/)
          or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /sys/fs/cgroup/kubepods.slice/)
          or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /sys/fs/cgroup/system.slice/)
          or (proc.exepath = /usr/lib/systemd/systemd and fd.name startswith /sys/fs/cgroup/user.slice/)
          or (proc.exepath = /usr/lib/systemd/systemd-journald and fd.name startswith /run/systemd/journal/streams/)
          or (proc.exepath = /usr/local/bin/containerd and fd.name startswith /run/containerd/)
          or (proc.exepath = /usr/local/bin/containerd and fd.name startswith /proc/self/fd/)
          or (proc.exepath = /usr/local/bin/containerd and fd.name startswith /var/lib/containerd/)
          or (proc.exepath = /usr/local/bin/containerd and fd.name startswith /var/log/pods/)
          or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name startswith /run/containerd/)
          or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name startswith /proc/self/fd/)
          or (proc.exepath = /usr/local/bin/containerd-shim-runc-v2 and fd.name startswith /sys/fs/cgroup/)
          or (proc.exepath = /usr/sbin/runc and fd.name startswith /sys/fs/cgroup/)
          or (proc.exepath = /usr/sbin/runc and fd.name startswith /run/containerd/)
          or (proc.exepath = /usr/sbin/sshd and fd.name in (/dev/null, /dev/ptmx, /dev/pts/0, /dev/tty, /proc/self/oom_score_adj, /var/log/lastlog, /var/log/wtmp, /var/run/utmp))
          or (proc.exepath = /usr/lib/sysstat/sadc and fd.name startswith /var/log/sysstat/sa)
          or (proc.cmdline = "6 init" and proc.name = 6 and proc.pname = runc and fd.name startswith /proc/self/oom_score_adj)
        ))
        or (proc.exepath = /usr/sbin/runc and fd.name startswith /proc/self/fd/)
        or (proc.exepath = /usr/sbin/runc and fd.name = /dev/null)
        or (k8s.ns.name = kube-system and k8s.pod.name startswith etcd- and proc.exepath = /usr/local/bin/etcd and fd.name startswith /var/lib/etcd/member/)
        or (k8s.ns.name = kube-flannel and k8s.pod.name startswith kube-flannel and proc.exepath = /opt/bin/flanneld and fd.name = /dev/null)
        or (k8s.ns.name = falco and (
           (k8s.pod.name startswith falco-falcosidekick-ui-redis- and proc.exepath = /opt/redis-stack/bin/redis-server and fd.name startswith /data/)
           or (k8s.pod.name startswith falco-falcosidekick-ui-redis- and proc.exepath = /opt/redis-stack/nodejs/bin/node and fd.name startswith /redisinsight/)
           or (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falcoctl and fd.name startswith /root/.sigstore/)
           or (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falcoctl and fd.name startswith /rulesfiles/)
           or (k8s.pod.name startswith falco- and proc.exepath = /usr/bin/falcoctl and fd.name startswith /tmp/falcoctl-)
        ))
        )

    - macro: symlink_at
      condition: (
        (evt.type = symlinkat and proc.exepath = /usr/lib/systemd/systemd and proc.name = systemd)
        or (evt.type = symlinkat and proc.exepath = /usr/sbin/runc and proc.name startswith runc:)
        )

    #    or (proc.exepath = /usr/lib/systemd/systemd-logind and fd.name startswith /run/systemd/sessions/)
    #    or (proc.exepath = /usr/lib/systemd/systemd-logind and fd.name startswith /run/systemd/users/)

    - macro: file_read_exempt
      condition: (
        file_read
        or libraries
        or user_apps_file_read
        )

    - macro: file_write_exempt
      condition: (
        file_write
        or symlink_at
        )

    - rule: Unexpected File Read
      desc: Detected unexpected File Read
      enabled: true
      condition: open_read and not file_read_exempt
      output: Detected Unexpected File Read (host=%evt.hostname file=%fd.name pcmdline=%proc.pcmdline gparent=%proc.aname[2] ggparent=%proc.aname[3] gggparent=%proc.aname[4] aname[5]=%proc.aname[5] aname[6]=%proc.aname[6] aname[7]=%proc.aname[7] evt_type=%evt.type read=%evt.is_open_read write=%evt.is_open_write user=%user.name user_uid=%user.uid user_loginuid=%user.loginuid process=%proc.name proc_exepath=%proc.exepath parent=%proc.pname command=%proc.cmdline terminal=%proc.tty exe_flags=%evt.arg.flags %container.info)
      priority: WARNING
      tags: [catch_all, file_read, ktaka]

    - rule: Unexpected File Write
      desc: Detected unexpected File Write
      enabled: true
      condition: (open_write or create_symlink or create_hardlink) and not file_write_exempt
      output: Detected Unexpected File  Write (host=%evt.hostname file=%fd.name pcmdline=%proc.pcmdline gparent=%proc.aname[2] ggparent=%proc.aname[3] gggparent=%proc.aname[4] aname[5]=%proc.aname[5] aname[6]=%proc.aname[6] aname[7]=%proc.aname[7] evt_type=%evt.type read=%evt.is_open_read write=%evt.is_open_write user=%user.name user_uid=%user.uid user_loginuid=%user.loginuid process=%proc.name proc_exepath=%proc.exepath parent=%proc.pname command=%proc.cmdline terminal=%proc.tty exe_flags=%evt.arg.flags %container.info)
      priority: WARNING
      tags: [catch_all, file_write, ktaka]
